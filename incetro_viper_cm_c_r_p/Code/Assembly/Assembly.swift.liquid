{% include 'header' %}
// swiftlint:disable unused_closure_parameter
// swiftlint:disable closure_parameter_position
// swiftlint:disable function_body_length

import UIKit
import Swinject
import TransitionHandler

// MARK: - {{ prefix }}{{ module_info.name }}ModuleAssembly

final {{ privacy }}class {{ prefix }}{{ module_info.name }}ModuleAssembly: CollectableAssembly {

    // MARK: - Initializers

    required {{ privacy }}init() {
    }

    // MARK: - Useful

    {{ privacy }}func obtainViewController() -> {{ prefix }}{{ module_info.name }}ViewController {
        container.resolve({{ prefix }}{{ module_info.name }}ViewController.self).unwrap()
    }

    // MARK: - Assembly

    {{ privacy }}func assemble(inContainer container: Container) {

        container.register({{ prefix }}{{ module_info.name }}ViewController.self) { resolver in
            let controller = {{ prefix }}{{ module_info.name }}ViewController()
            let contentManager = resolver.resolve(
                {{ prefix }}{{ module_info.name }}ContentManager.self,
                arguments: controller as TransitionHandler, controller.tableView
            ).unwrap()
            controller.output = resolver.resolve(
                {{ prefix }}{{ module_info.name }}ViewOutput.self,
                arguments: controller as {{ prefix }}{{ module_info.name }}ViewInput, contentManager
            )
            return controller
        }

        container.register({{ prefix }}{{ module_info.name }}RouterInput.self) { (resolver, transitionHandler: TransitionHandler) in
            let router = {{ prefix }}{{ module_info.name }}Router(transitionHandler: transitionHandler)
            return router
        }

        container.register({{ prefix }}{{ module_info.name }}ViewOutput.self) { (
            resolver,
            view: {{ prefix }}{{ module_info.name }}ViewInput,
            contentManager: {{ prefix }}{{ module_info.name }}ContentManager
        ) in
            let viewModelDesigner = resolver.resolve({{ custom_parameters.cell }}CellViewModelDesigner.self).unwrap()
            let transitionHandler = (view as? TransitionHandler).unwrap()
            let router = resolver.resolve(
                {{ prefix }}{{ module_info.name }}RouterInput.self,
                argument: transitionHandler
            ).unwrap()
            let interactor = resolver
                .resolve({{ prefix }}{{ module_info.name }}InteractorInput.self)
                .unwrap(as: {{ prefix }}{{ module_info.name }}Interactor.self)
            let presenter = {{ prefix }}{{ module_info.name }}Presenter(
                view: view,
                interactor: interactor,
                router: router,
                contentManager: contentManager,
                viewModelDesigner: viewModelDesigner
            )
            interactor.output = presenter
            return presenter
        }

        container.register({{ prefix }}{{ module_info.name }}InteractorInput.self) { resolver in
            let {{ service_uncap }}Service = resolver.resolve({{ prefix }}{{ custom_parameters.service }}Service.self).unwrap()
            let interactor = {{ prefix }}{{ module_info.name }}Interactor({{ service_uncap }}Service: {{ service_uncap }}Service)
            return interactor
        }

        container.register({{ custom_parameters.cell }}CellPresenterFactory.self) { (resolver, transitionHandler: TransitionHandler) in
            let container = resolver.resolve(Container.self).unwrap()
            let {{ module_name_uncap }}Router = container.resolve({{ module_info.name }}RouterInput.self, argument: transitionHandler).unwrap()
            return {{ custom_parameters.cell }}CellPresenterFactoryImplementation(container: container, {{ module_name_uncap }}Router: {{ module_name_uncap }}Router)
        }

        container.register({{ custom_parameters.cell }}CellViewModelDesigner.self) { resolver in
            {{ custom_parameters.cell }}CellViewModelDesignerImplementation()
        }

        container.register({{ prefix }}{{ module_info.name }}ContentManager.self) { (
            resolver,
            transitionHandler: TransitionHandler,
            tableView: UITableView
        ) in
            let presentersFactory = resolver.resolve({{ custom_parameters.cell }}CellPresenterFactory.self, argument: transitionHandler).unwrap()
            let contentManager = {{ prefix }}{{ module_info.name }}ContentManagerImplementation(tableView: tableView, presentersFactory: presentersFactory)
            return contentManager
        }
    }
}
